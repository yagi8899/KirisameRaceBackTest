# 確認項目チェックリスト 🧪

**実施日**: 2026年1月11日  
**対象バージョン**: Phase 7完了版（Milestone 3達成）

---

## 🎯 事前準備

- [✅] バックエンドサーバーが起動している (`http://localhost:8000`)
- [✅] フロントエンドサーバーが起動している (`http://localhost:5173`)
- [✅] ブラウザで `http://localhost:5173` にアクセスできる
- [✅] 予測データファイル（TSV形式）を用意している

---

## 📦 Phase 1-6: 基本機能（既存）

### 1. ファイルアップロード
- [✅] TSVファイルを選択できる
- [✅] アップロードボタンが表示される
- [✅] アップロード後に「データ統計」セクションが表示される
- [✅] 統計カード（総レース数、総馬数、平均頭数、予測精度）が正しく表示される

### 2. 戦略選択
- [✅] 6つの戦略ボタン（単勝/複勝/馬連/ワイド/馬単/3連複）が表示される
- [✅] 選択した戦略がハイライトされる

### 3. パラメータ設定（Phase 6実装）
- [✅] **購入金額スライダー**: 100円〜10,000円の範囲で調整できる
- [✅] **上位N頭セレクト**: 1〜10頭を選択できる
- [✅] **スコア閾値スライダー**: 0.0〜1.0の範囲で調整できる
- [✅] **軸馬番号入力**: 1〜18の馬番を入力できる（任意）

### 4. フィルタ設定（Phase 6実装）
- [✅] **アコーディオン展開**: 「フィルタ設定」をクリックして開閉できる
- [✖] **競馬場選択**: 10競馬場のチェックボックスが表示される→ボタンを押しても選択されているかどうかがわからない
  - 札幌、函館、福島、新潟、東京、中山、中京、京都、阪神、小倉
- [✖] **馬場選択**: 「芝」「ダート」ボタンが表示される→ボタンを押しても選択されているかどうかがわからない
- [✅] **距離スライダー**: 1000m〜3600mの範囲で調整できる
- [✅] **日付範囲**: 開始日と終了日を選択できる
- [✅] **オッズ範囲スライダー**: 1.0倍〜100.0倍の範囲で調整できる
- [✅] **フィルタクリアボタン**: すべてのフィルタをリセットできる

### 5. バックテスト実行
- [✅] 「バックテストを実行」ボタンが表示される
- [✅] 実行中は「バックテスト実行中...」と表示される
- [✅] 実行後に結果セクションが表示される

### 6. 結果表示（基本）
- [✅] **サマリーカード**: 総利益、ROI、的中率などが表示される
- [✅] **収支推移グラフ**: 累積利益の折れ線グラフが表示される
- [✅] **詳細テーブル**: レース別の購入・払戻情報が表示される

---

## 🚀 Phase 7: 新機能（今回実装分）

### 7. グリッドサーチ機能（FR-007）
- [✅] **グリッドサーチパネル**が表示される
- [✅] **パラメータ範囲入力**
  - [✅] 購入金額: カンマ区切りで複数値を入力（例: 100,200,500）
  - [✅] 上位N頭: カンマ区切りで複数値を入力（例: 1,2,3）
  - [✅] スコア閾値: カンマ区切りで複数値を入力（例: 0.0,0.3,0.5）
- [✅] **組み合わせ総数**が表示される（例: 27通り）
- [✅] **グリッドサーチ実行ボタン**をクリックできる
- [✅] 実行中は「グリッドサーチ実行中...」と表示される
- [✅] **結果リスト**が表示される
  - [✅] ROI降順でソートされている
  - [✅] 最良の結果に👑アイコンが表示される
  - [✅] 各結果に10項目（購入額、topN、閾値、ROI、的中率など）が表示される
  - [✅] 上位10件のみ表示される
- [✅] **最良パラメータの自動適用**
  - [✅] グリッドサーチ後、パラメータフォームに最良値が反映される

### 8. 追加グラフ（FR-009）

#### 8-1. ROI推移グラフ
- [✖] **グラフ表示**: 折れ線グラフが表示される→レース1の分しか表示されていない
- [✖] **ROI計算**: 累積利益÷累積投資額×100%で正しく計算される→グラフの表示が不正のため未確認
- [✖] **100%基準線**: 赤い点線で損益分岐点が表示される
- [✅] **ツールチップ**: レース番号とROI値が表示される

#### 8-2. 的中率分析グラフ
- [✅] **3タブ表示**: 「競馬場別」「距離帯別」「芝ダート別」タブが表示される
- [✅] **競馬場別タブ**
  - [✅] 10競馬場の的中率が棒グラフで表示される
  - [ ] 的中率の高い順にソートされる
  - [✅] ツールチップに「的中数/総数」が表示される
- [✅] **距離帯別タブ**
  - [✅] 距離帯が分類される（1000-1600m、1700以上）
  - [✅] 棒グラフで表示される
- [✅] **芝ダート別タブ**
  - [✅] 「芝」「ダート」の2項目が棒グラフで表示される

#### 8-3. オッズ分布グラフ
- [✅] **ヒストグラム表示**: 7つのオッズ範囲の的中回数が表示される
  - 1.0-2.0倍、2.0-3.0倍、3.0-5.0倍、5.0-10.0倍、10.0-20.0倍、20.0-50.0倍、50.0倍以上
- [✅] **二軸グラフ**: 左軸が的中回数、右軸が総払戻額
- [✅] **統計カード**（グラフ上部）
  - [✅] 総的中回数が表示される
  - [✅] 平均的中オッズが表示される（小数点1桁）
  - [✅] 最高的中オッズが表示される（小数点1桁）

### 9. テーブル拡張機能（FR-010）

#### 9-1. ページネーション
- [✅] **1ページ50件**で表示される
- [✅] **ページ情報**が表示される（例: 1〜50件 / 全200件）
- [✅] **ナビゲーションボタン**
  - [✅] ≪（最初のページ）ボタン
  - [✅] ＜（前のページ）ボタン
  - [✅] ページ番号表示（例: 1 / 4）
  - [✅] ＞（次のページ）ボタン
  - [✅] ≫（最後のページ）ボタン
- [✅] 先頭/末尾ページでは対応ボタンが無効化される

#### 9-2. ソート機能
- [✅] **全12カラム**でソート可能
  - 競馬場、日付、R、芝/ダ、距離、馬番、購入、オッズ、着順、的中、払戻、損益
- [✅] **カラムヘッダーをクリック**してソート
  - [✅] 初回クリック: 昇順ソート、⇅が↑に変わる
  - [✅] 2回目クリック: 降順ソート、↑が↓に変わる
- [✖] **ホバー効果**: ヘッダーにマウスを乗せると背景色が変わる
- [✅] **数値/文字列/真偽値**が正しくソートされる

#### 9-3. CSV出力
- [✅] **CSV出力ボタン**が右上に表示される（📥 CSV出力）
- [✅] ボタンをクリックするとCSVファイルがダウンロードされる
- [✅] **ファイル名**: `backtest_results_YYYY-MM-DD.csv`形式
- [✅] **文字コード**: UTF-8 BOM付き（Excelで文字化けしない）
- [✅] **カラム**: 14列すべて含まれる
- [✅] **的中フラグ**: 「的中」「不的中」のテキストで出力される
- [✅] Excelで開いて日本語が正しく表示される

### 10. 戦略比較機能（FR-011）

#### 10-1. 戦略設定
- [✅] **戦略比較パネル**が表示される
- [✅] **デフォルト2戦略**が設定されている
- [✅] **戦略追加ボタン**（➕ 戦略追加）で戦略を増やせる
- [✅] **戦略削除ボタン**で戦略を減らせる（最低1戦略は残る）
- [✅] **各戦略の設定項目**
  - [✅] 戦略名: テキスト入力可能
  - [✅] 戦略タイプ: 6種類から選択（単勝/複勝/馬連/ワイド/馬単/3連複）
  - [✅] 購入額: 100〜10,000円
  - [✅] 上位N頭: 1〜10
  - [✅] スコア閾値: 0.0〜1.0

#### 10-2. 比較実行
- [✅] **比較実行ボタン**（🔍 比較実行）が表示される
- [✅] クリックすると「比較中...」と表示される
- [✅] エラーなく完了する

#### 10-3. 比較結果表示

**レーダーチャート**
- [✅] 5軸のレーダーチャートが表示される
  - ROI、的中率、購入数、平均オッズ、総利益
- [✅] 各戦略が異なる色で表示される
- [✅] 凡例で戦略名が表示される
- [✅] 値が正規化されて0〜100の範囲で表示される

**比較テーブル**
- [✅] 全戦略の結果が1行ずつ表示される
- [✅] ROI降順でソートされている
- [✅] **最優秀戦略**（1位）
  - [✖] 行が黄色背景でハイライトされる
  - [✅] 戦略名の前に👑アイコンが表示される
  - [✖] 太字で表示される
- [✅] **10項目**が表示される
  - 戦略名、総レース、購入数、的中、的中率、投資額、払戻額、総利益、ROI、平均オッズ
- [✖] 利益・ROIが正負で色分けされる（緑/赤）

**ベスト戦略ハイライト**
- [✖] テーブル下部に黄色〜オレンジのグラデーション枠が表示される
- [✅] 🏆アイコン付きで最優秀戦略名が表示される
- [✅] 4項目のサマリー（ROI、的中率、総利益、平均オッズ）が表示される

---

## 🐛 Phase 8: バグ修正の確認

### 11. エラー・警告のチェック
- [✅] ブラウザの開発者ツール（F12）を開く
- [✅] **コンソールタブ**を確認
  - [✅] エラー（赤）が表示されていない
  - [✅] 警告（黄）が表示されていない（一部ライセンス警告は許容）
- [✅] **ネットワークタブ**を確認
  - [✅] APIリクエストが200 OKで返る
  - [✅] エラーレスポンス（4xx、5xx）がない

### 12. データ永続性
- [✅] ファイルアップロード後にページをリロードする
- [✅] アップロード情報が保持されている（localStorageから復元）
- [✅] バックテスト結果は消える（これは仕様）

---

## 📊 実データでの動作確認

### 13. 実際のシナリオテスト

**シナリオ1: 基本的なバックテスト**
1. [✅] predicted_results_all.tsvをアップロード
2. [✅] 単勝戦略を選択
3. [✅] パラメータはデフォルト（購入額100円、topN=1）
4. [✅] バックテスト実行
5. [✅] 結果が表示され、ROIが計算される

**シナリオ2: フィルタを使ったバックテスト**
1. [✅] フィルタ設定を開く
2. [✅] 競馬場「東京」のみ選択
3. [✅] 芝のみ選択
4. [✅] 距離1800m〜2400mに設定
5. [✅] バックテスト実行
6. [✅] 結果が東京競馬場・芝・1800-2400mのみに絞られている

**シナリオ3: グリッドサーチでパラメータ最適化**
1. [✅] 購入金額に「100,200,500」を入力
2. [✅] topNに「1,2,3」を入力
3. [✅] スコア閾値に「0.0,0.3,0.5」を入力
4. [✅] 組み合わせ総数「27通り」と表示される
5. [✅] グリッドサーチ実行
6. [✅] 結果がROI降順で表示される
7. [✅] 最良パラメータがパラメータフォームに反映される

**シナリオ4: 戦略比較**
1. [✅] 戦略比較パネルを開く
2. [✅] 戦略1: 単勝・購入額100円・topN=1
3. [✅] 戦略2: 複勝・購入額200円・topN=2
4. [✅] 戦略3を追加: 馬連・購入額300円・topN=3
5. [✅] 比較実行→失敗する「戦略比較に失敗しました」
6. [✅] レーダーチャートで3戦略が比較表示される
7. [✅] テーブルで最優秀戦略が👑付きでハイライトされる

**シナリオ5: テーブル操作**
1. [✅] バックテスト実行後、詳細テーブルを確認
2. [✅] 「ROI」カラムをクリックしてソート（降順→昇順）
3. [✅] ページネーションで2ページ目に移動
4. [✅] CSV出力ボタンをクリック
5. [✅] ダウンロードされたCSVをExcelで開く
6. [✅] 日本語が文字化けしていない
7. [✅] 全データが含まれている

---

## 🎨 UI/UXの確認

### 14. レスポンシブデザイン
- [ ] ブラウザ幅を変更しても表示が崩れない
- [ ] グラフが画面幅に応じてリサイズされる
- [ ] テーブルが横スクロール可能

### 15. 操作性
- [ ] ボタンのホバー効果が動作する
- [ ] スライダーがスムーズに動く
- [ ] アコーディオンの開閉がスムーズ
- [ ] ローディング中は操作不可になる

### 16. 視覚的フィードバック
- [ ] 成功時は緑色で表示される
- [ ] 損失時は赤色で表示される
- [ ] 的中行は背景色が変わる（薄緑）
- [ ] 最良結果は👑アイコンで強調される

---

## 🚨 既知の制限事項（仕様）

以下は問題ではなく、現在の仕様です：

1. **FastAPI/Tailwind CSS のインポートエラー**: Pylanceが認識していないだけで、実際には動作しています
2. **ページリロード時の結果消失**: セキュリティとメモリ効率のため、バックテスト結果はlocalStorageに保存していません
3. **npm audit の脆弱性警告**: 開発環境のみの依存関係で、本番環境には影響ありません

---

## ✅ 確認完了後のアクション

すべての項目を確認後：
- [ ] **問題なし** → Phase 9（ドキュメント整備）に進む
- [ ] **バグ発見** → 詳細を報告し、修正を依頼

---

**確認担当者**: ________  
**確認日時**: ________  
**備考**: 
