# ベストプラクティスガイド - 競馬バックテストシステムの最良の使い方

## 📖 目次
1. [はじめに](#はじめに)
2. [基本原則](#基本原則)
3. [3段階最適化アプローチ](#3段階最適化アプローチ)
4. [実践手順](#実践手順)
5. [推奨設定](#推奨設定)
6. [避けるべき罠](#避けるべき罠)
7. [成功事例](#成功事例)
8. [まとめ](#まとめ)

---

## はじめに

このガイドは、Kirisame Race BackTestシステムを使って**実際に利益を出すための実践的な方法論**をまとめたものです。

### 🎯 このガイドの目的

- ❌ 全レースで勝つ方法を教える → **不可能**
- ✅ 勝てる条件を見つけて、そこだけで勝負する方法を教える → **可能**

### 📊 現実的な目標

| 指標 | 現実的な目標 | 非現実的な期待 |
|------|-----------|------------|
| ROI | 10〜25% | 100%以上 |
| 的中率（複勝） | 50〜70% | 90%以上 |
| 年間投資レース数 | 50〜200レース | 全レース |
| 利益の安定性 | 月単位で±あり | 毎月プラス確実 |

---

## 基本原則

### 原則1: 予測モデルには得意・不得意がある

```
✅ 良い考え方:
「このモデルはどの条件で精度が高いか？」
→ その条件だけで勝負

❌ 悪い考え方:
「すべてのレースで勝ちたい」
→ 不得意な条件でも投資して損失
```

### 原則2: 過去の成功は未来を保証しない

```
✅ 良い考え方:
「2024年前半で成功した戦略が、後半でも機能するか検証」
→ Walk-Forward検証で頑健性確認

❌ 悪い考え方:
「2024年のデータで最適化したから完璧」
→ オーバーフィッティング（過学習）
```

### 原則3: サンプルサイズが重要

```
✅ 良い考え方:
「100レース以上のデータで検証」
→ 統計的に信頼できる

❌ 悪い考え方:
「10レースで的中率80%だから完璧」
→ 偶然の可能性大
```

---

## 3段階最適化アプローチ

### Stage 1: 条件特定（Condition Discovery）

**目的**: 予測モデルが得意な条件を見つける

#### 1-1. 競馬場別分析

```
手順:
1. フィルタで「中山」のみ選択 → バックテスト実行 → ROI記録
2. フィルタで「阪神」のみ選択 → バックテスト実行 → ROI記録
3. フィルタで「東京」のみ選択 → バックテスト実行 → ROI記録
...

結果例:
- 中山: ROI 25% ✅
- 阪神: ROI 15% ✅
- 東京: ROI -5% ❌
- 京都: ROI 12% ✅

結論: 中山・阪神・京都のみに絞る
```

#### 1-2. 距離帯別分析

```
手順:
1. フィルタで距離「1000〜1600m」 → バックテスト → ROI記録
2. フィルタで距離「1700〜2000m」 → バックテスト → ROI記録
3. フィルタで距離「2100m以上」 → バックテスト → ROI記録

結果例:
- 短距離(〜1600m): ROI 18% ✅
- マイル(1700〜2000m): ROI 8% ⚠️
- 長距離(2100m〜): ROI -12% ❌

結論: 短距離のみに絞る
```

#### 1-3. 馬場状態別分析

```
手順:
1. フィルタで馬場「良」のみ → バックテスト → ROI記録
2. フィルタで馬場「稍重」のみ → バックテスト → ROI記録
3. フィルタで馬場「重」のみ → バックテスト → ROI記録
4. フィルタで馬場「不良」のみ → バックテスト → ROI記録

結果例:
- 良: ROI 20% ✅
- 稍重: ROI 5% ⚠️
- 重: ROI -10% ❌
- 不良: ROI -15% ❌

結論: 良馬場のみに絞る
```

#### 1-4. オッズ帯別分析（重要！）

```
手順:
1. フィルタでオッズ「1.0〜2.0倍」 → バックテスト → ROI記録
2. フィルタでオッズ「2.1〜4.0倍」 → バックテスト → ROI記録
3. フィルタでオッズ「4.1〜8.0倍」 → バックテスト → ROI記録
4. フィルタでオッズ「8.1倍以上」 → バックテスト → ROI記録

結果例:
- 1.0〜2.0倍（本命）: ROI 5% ⚠️（的中率高いが配当低い）
- 2.1〜4.0倍（中穴）: ROI 28% ✅（バランス良い）
- 4.1〜8.0倍（穴）: ROI 15% ✅（配当高いが的中率低下）
- 8.1倍以上（大穴）: ROI -20% ❌（当たらない）

結論: 2.1〜4.0倍の中穴に絞る
```

#### Stage 1 の結果統合

```
最適条件:
✅ 競馬場: 中山・阪神
✅ 距離: 1000〜1600m（短距離）
✅ 馬場: 良
✅ オッズ: 2.1〜4.0倍

→ この条件でフィルタ設定して次のステージへ
```

---

### Stage 2: パラメータ最適化（Parameter Optimization）

**目的**: Stage 1で特定した条件下で、最適な投資パラメータを見つける

#### 2-1. スコア閾値の重要性

```
スコア閾値 = 予測モデルの「確信度」の最低ライン

低い閾値（0.0〜0.3）:
- 投資機会: 多い（年間500レース）
- 的中率: 低い（40%）
- ROI: 低い（5%）

中程度の閾値（0.4〜0.6）:
- 投資機会: 適度（年間200レース）
- 的中率: 中程度（55%）
- ROI: 良い（15%）

高い閾値（0.7〜0.9）:
- 投資機会: 少ない（年間50レース）
- 的中率: 高い（70%）
- ROI: 最良（25%）✅

推奨: 0.6〜0.8
```

#### 2-2. グリッドサーチの実行

```
手順:
1. Stage 1の最適条件でフィルタ設定
2. グリッドサーチを開く
3. 探索範囲を設定:
   - 購入額: 100, 200, 300円
   - TopN: 1, 2
   - スコア閾値: 0.0, 0.3, 0.5, 0.7

4. 実行ボタンをクリック
5. 結果テーブルで最高ROIの組み合わせを確認

推奨結果例:
- 購入額: 100円（固定が安全）
- TopN: 1（最有力馬のみ）
- スコア閾値: 0.7（高確信度のみ）
- ROI: 22.5%
```

#### 2-3. TopNの選び方

```
TopN = 1（最有力馬のみ）:
✅ シンプル
✅ 的中率が最も高い
✅ 単勝・複勝向け
推奨: 初心者向け

TopN = 2（上位2頭）:
⚠️ 馬連・ワイド向け
⚠️ 組み合わせが増える
推奨: 中級者向け

TopN = 3（上位3頭）:
❌ 複雑
❌ 三連複向けだがリスク高い
推奨: 非推奨
```

---

### Stage 3: Walk-Forward検証（Validation）

**目的**: 最適化した戦略が本当に機能するか、時期を変えて検証

#### 3-1. データ分割

**推奨: 複数年にまたがる検証（最も信頼性が高い）**

```
データ期間: 2023年1月1日 〜 2025年12月31日（3年間）

分割方法:
┌──────────────┬──────────────┬──────────────┐
│ Training     │ Validation   │ Test         │
│ 2023年全体   │ 2024年全体   │ 2025年全体   │
│ 最適化に使用  │ 検証         │ 最終テスト    │
└──────────────┴──────────────┴──────────────┘

利点:
✅ 長期的な頑健性を確認（3年間＝36ヶ月）
✅ 季節性・環境変化に対応できるか検証
✅ 実運用に最も近い状況でテスト
```

**代替案: 1年間での簡易検証（データが少ない場合）**

```
データ期間: 2024年1月1日 〜 12月31日

分割方法:
┌──────────────┬──────────────┬──────────────┐
│ Training     │ Validation   │ Test         │
│ 1-6月        │ 7-9月        │ 10-12月      │
│ 最適化に使用  │ 検証         │ 最終テスト    │
└──────────────┴──────────────┴──────────────┘

注意: 短期間のため、信頼性は複数年検証より低い
```

#### 3-2. 検証手順（3年間の場合）

```
Step 1: Training（2023年）
- フィルタで日付「2023/1/1〜2023/12/31」設定
- Stage 1で条件特定（競馬場・距離・オッズ帯等）
- Stage 2でパラメータ最適化（グリッドサーチ）
- 最適戦略を記録
  例: 中山・短距離・オッズ2-4.5倍・閾値0.7 → ROI 22%

Step 2: Validation（2024年）
- フィルタの日付を「2024/1/1〜2024/12/31」に変更
- 2023年で得た最適条件・パラメータをそのまま適用
- バックテスト実行
- ROIを確認
  例: ROI 16%

判定:
✅ ROI > 10% → Step 3へ
⚠️ ROI 0〜10% → 条件を微調整して再検証
❌ ROI < 0% → 戦略を根本的に見直す（オーバーフィッティング）

Step 3: Test（2025年）
- フィルタの日付を「2025/1/1〜2025/12/31」に変更
- 同じ条件・パラメータを適用
- バックテスト実行
- ROIを確認
  例: ROI 14%

最終判定:
✅ 3年間すべてでROI > 10% → 信頼できる戦略
⚠️ 2年間プラス、1年間マイナス → やや不安定だが許容範囲
❌ 2年間以上でマイナス → 使用不可

追加チェック:
- 年次トレンド確認: 右肩下がりでないか？
- サンプルサイズ: 各年で50レース以上投資しているか？
```

#### 3-3. 期待値の調整

**3年間検証の場合:**

```
Training ROI (2023年): 22%
Validation ROI (2024年): 16%
Test ROI (2025年): 14%

→ 平均ROI: (22 + 16 + 14) / 3 = 17.3%

実運用での期待値: 17.3% × 0.7 = 12.1%
（70%掛けは「未知のデータ」への安全マージン）

年間期待利益（100円×150レース投資の場合）:
投資額: 15,000円
期待リターン: 16,815円
期待利益: +1,815円
```

**注意: 年次トレンドの確認**

```
良い例（安定型）:
2023年: 18%
2024年: 16%
2025年: 17%
→ 安定している ✅ 実運用推奨

悪い例（劣化型）:
2023年: 25%
2024年: 15%
2025年: 5%
→ 右肩下がり ❌ 予測精度が劣化している可能性
→ 実運用は危険

許容範囲（変動型）:
2023年: 20%
2024年: 8%
2025年: 18%
→ 2024年だけ悪い（馬場改修等の環境変化？）
→ 原因を分析して判断
```

---

## 実践手順

### 📍 初心者向け：5ステップ実践法

#### Step 1: データ準備（1日目）
```
1. TSVファイルをアップロード
2. データ概要で以下を確認:
   - 総レース数: 500以上あるか？
   - 期間: 6ヶ月以上あるか？
   - 競馬場: 複数あるか？
```

#### Step 2: 賭式選択（1日目）
```
推奨: 複勝（PLACE）
理由:
- 的中率が高い（50〜70%）
- 初心者でも扱いやすい
- 安定した利益

他の選択肢:
- 単勝: シンプルだが配当低い
- 馬連/ワイド: 複雑だが配当高い
```

#### Step 3: 条件探索（2〜3日目）
```
競馬場別テスト:
1. 中山のみ → バックテスト → ROI記録
2. 阪神のみ → バックテスト → ROI記録
3. 東京のみ → バックテスト → ROI記録
...

距離帯テスト:
1. 短距離（〜1600m） → バックテスト → ROI記録
2. 中距離（1700〜2400m） → バックテスト → ROI記録
3. 長距離（2500m〜） → バックテスト → ROI記録

馬場テスト:
1. 良のみ → バックテスト → ROI記録
2. 稍重のみ → バックテスト → ROI記録
3. 重・不良 → バックテスト → ROI記録

オッズテスト（最重要！）:
1. 1.0〜2.0倍 → バックテスト → ROI記録
2. 2.1〜4.0倍 → バックテスト → ROI記録
3. 4.1〜8.0倍 → バックテスト → ROI記録
4. 8.1倍以上 → バックテスト → ROI記録

→ ROIが最も高い条件の組み合わせを記録
```

#### Step 4: パラメータ最適化（3日目）
```
1. Step 3で見つけた条件でフィルタ設定
2. グリッドサーチを実行:
   - 購入額: 100円固定
   - TopN: 1, 2, 3
   - スコア閾値: 0.0, 0.3, 0.5, 0.7, 0.9

3. 結果テーブルで最良の組み合わせを確認
4. その設定でバックテスト実行
5. ROI・的中率・投資レース数を記録
```

#### Step 5: Walk-Forward検証（4〜5日目）
```
1. データを3分割（前半・中盤・後半）
2. 各期間で同じパラメータを適用
3. ROIを比較:
   
   前半: ROI 25%
   中盤: ROI 18%
   後半: ROI 15%
   
   → すべてプラスなら信頼できる

4. 実運用期待値を計算:
   平均ROI × 0.7 = 実運用期待値
```

---

### 📍 中級者向け：戦略比較アプローチ

#### 複数戦略の並行評価

```
戦略A: 保守的
- 賭式: 複勝
- スコア閾値: 0.8（超高確信度）
- オッズ: 1.5〜3.0倍
- 期待ROI: 15%
- 期待的中率: 70%

戦略B: バランス型
- 賭式: 単勝
- スコア閾値: 0.6（高確信度）
- オッズ: 2.0〜5.0倍
- 期待ROI: 20%
- 期待的中率: 50%

戦略C: アグレッシブ
- 賭式: 馬連
- スコア閾値: 0.5（中確信度）
- オッズ: 3.0〜8.0倍
- 期待ROI: 25%
- 期待的中率: 35%

→ 戦略比較機能で3つを並べて評価
→ 自分のリスク許容度に合うものを選択
```

---

## 推奨設定

### 🏆 推奨設定 #1: 安定重視型

```yaml
目的: 安定した利益を長期的に積み上げる

設定:
  賭式: 複勝（PLACE）
  
  フィルタ:
    競馬場: [中山, 阪神, 京都]
    馬場: [良]
    距離: 1000〜1600m
    オッズ: 1.5〜4.0倍
  
  パラメータ:
    購入額: 100円
    TopN: 1
    スコア閾値: 0.7
  
  期待値:
    年間投資レース数: 80〜150レース
    的中率: 65〜75%
    ROI: 12〜18%
    年間期待利益: +1,000〜2,700円（100円×150レース想定）

  向いている人:
    ✅ リスクを避けたい
    ✅ 長期的に安定した利益を求める
    ✅ 大きな損失を避けたい
```

---

### 🚀 推奨設定 #2: 攻めの利益追求型

```yaml
目的: 高ROIを狙って大きな利益を狙う

設定:
  賭式: 単勝（WIN）
  
  フィルタ:
    競馬場: [中山, 阪神]
    馬場: [良]
    距離: 1200〜1600m
    オッズ: 2.5〜6.0倍
  
  パラメータ:
    購入額: 200円
    TopN: 1
    スコア閾値: 0.8
  
  期待値:
    年間投資レース数: 50〜100レース
    的中率: 45〜55%
    ROI: 20〜30%
    年間期待利益: +2,000〜6,000円（200円×100レース想定）

  向いている人:
    ✅ ある程度のリスクを取れる
    ✅ 高ROIを追求したい
    ✅ 少数精鋭の投資を好む
```

---

### 🎯 推奨設定 #3: バランス型

```yaml
目的: リスクとリターンのバランスを取る

設定:
  賭式: ワイド（WIDE）
  
  フィルタ:
    競馬場: [中山, 阪神, 東京]
    馬場: [良, 稍重]
    距離: 1000〜2000m
    オッズ: 1.8〜5.0倍
  
  パラメータ:
    購入額: 100円
    TopN: 2
    スコア閾値: 0.6
  
  期待値:
    年間投資レース数: 100〜200レース
    的中率: 50〜60%
    ROI: 15〜22%
    年間期待利益: +1,500〜4,400円（100円×200レース想定）

  向いている人:
    ✅ 中程度のリスク許容度
    ✅ 適度な投資機会が欲しい
    ✅ 複数馬の組み合わせを楽しみたい
```

---

## 避けるべき罠

### 🚫 罠1: オーバーフィッティング（過学習）

```
症状:
「2024年データでROI 80%！完璧だ！」
→ 2025年に実運用したらROI -10%...

原因:
- 過去データに過剰適合
- パラメータを細かく調整しすぎ
- Walk-Forward検証をしていない

対策:
✅ 必ずWalk-Forward検証を実施
✅ 複数期間で一貫してプラスか確認
✅ 期待値は控えめに見積もる（0.7掛け）
```

---

### 🚫 罠2: サンプルサイズ不足

```
症状:
「10レース投資して9レース的中！的中率90%だ！」

原因:
- サンプル数が少なすぎる
- 偶然の連続を実力と誤認

対策:
✅ 最低100レース以上で判断
✅ 200レース以上が理想
✅ 的中率だけでなくROIも確認
```

---

### 🚫 罠3: 全条件で勝とうとする

```
症状:
「すべての競馬場・すべての距離で利益を出したい」

原因:
- 予測モデルには得意・不得意がある
- 不得意な条件でも投資してしまう

対策:
✅ 条件別にROIを分析
✅ 得意な条件だけに絞る
✅ 不得意な条件は捨てる勇気を持つ
```

---

### 🚫 罠4: パラメータの頻繁な変更

```
症状:
「今週はマイナスだったから、パラメータ変更しよう」
→ 毎週変更 → 一貫性がない → 検証不可能

原因:
- 短期的な結果に一喜一憂
- 長期視点がない

対策:
✅ 最低3ヶ月は同じ戦略を継続
✅ 月単位で結果を評価
✅ 頻繁な変更は避ける
```

---

### 🚫 罠5: 高オッズの罠

```
症状:
「10倍以上の大穴を狙えば一発逆転！」
→ 10レース連続不的中...

原因:
- 配当の高さに目が眩む
- 的中率の低さを軽視

対策:
✅ オッズ帯別にROIを分析
✅ 通常は2〜6倍程度が最適
✅ 大穴（10倍以上）は避ける
```

---

## 成功事例

### 📈 事例1: 短距離芝・中穴狙い戦略

```
ユーザー属性: 初心者

設定:
- 賭式: 複勝
- 競馬場: 中山・阪神
- 距離: 1200〜1600m
- 馬場: 良
- オッズ: 2.0〜4.5倍
- スコア閾値: 0.75
- TopN: 1

結果（6ヶ月運用）:
- 投資レース数: 87レース
- 総投資額: 8,700円（100円×87）
- 総払戻: 10,450円
- 総利益: +1,750円
- ROI: 20.1%
- 的中率: 68%

成功要因:
✅ 条件を厳しく絞った
✅ スコア閾値を高めに設定
✅ 中穴（2〜4.5倍）に集中
```

---

### 📈 事例2: 単勝・高確信度戦略

```
ユーザー属性: 中級者

設定:
- 賭式: 単勝
- 競馬場: 中山・阪神・京都
- 距離: 1000〜2000m
- 馬場: 良・稍重
- オッズ: 2.5〜7.0倍
- スコア閾値: 0.85（超高確信度）
- TopN: 1

結果（1年運用）:
- 投資レース数: 52レース
- 総投資額: 10,400円（200円×52）
- 総払戻: 13,520円
- 総利益: +3,120円
- ROI: 30.0%
- 的中率: 52%

成功要因:
✅ スコア閾値を極端に高く設定（0.85）
✅ 少数精鋭の投資（年間52レース）
✅ 的中率は低いが、ROIが高い
```

---

### 📈 事例3: Walk-Forward検証で発見

```
ユーザー属性: 上級者

手法:
1. 2024年1-6月で条件探索
   → 中山・短距離・良馬場が最適と判明

2. 2024年7-9月で検証
   → ROI 18%で継続可能と判断

3. 2024年10-12月でテスト
   → ROI 15%で安定と確認

4. 2025年実運用
   → ROI 12%（期待通り）

設定:
- 賭式: 複勝
- 競馬場: 中山のみ
- 距離: 1200〜1400m
- 馬場: 良
- オッズ: 1.8〜3.5倍
- スコア閾値: 0.7
- TopN: 1

結果（2025年1〜6月実運用）:
- 投資レース数: 45レース
- 総投資額: 4,500円（100円×45）
- 総払戻: 5,040円
- 総利益: +540円
- ROI: 12.0%
- 的中率: 71%

成功要因:
✅ Walk-Forward検証を徹底
✅ 期待値を控えめに設定（実運用で達成）
✅ 条件を極限まで絞った
```

---

## まとめ

### ✅ 成功の鍵

1. **条件を絞る**
   - 得意な競馬場・距離・馬場・オッズ帯だけに投資
   - 全レースで勝とうとしない

2. **高確信度のみ投資**
   - スコア閾値を0.6以上に設定
   - 少数精鋭の投資を心がける

3. **Walk-Forward検証**
   - 過去データで最適化
   - 別期間で検証
   - テスト期間で最終確認

4. **長期視点**
   - 月単位で評価
   - 短期的な損失に動揺しない
   - 戦略を頻繁に変更しない

5. **現実的な目標**
   - ROI 10〜25%を目指す
   - 100%以上は期待しない
   - 安定性を重視

---

### 🎯 このシステムの本質

```
このシステムは「魔法の予測ツール」ではない。

このシステムは「科学的な検証ツール」である。

✅ 予測モデルの得意・不得意を可視化
✅ データドリブンな戦略構築を支援
✅ Walk-Forward検証で頑健性を確認

→ 「勝てる条件を見つけて、そこだけで勝負する」
```

---

### 📊 最後に

競馬投資で最も重要なのは**規律**です。

- ✅ 決めた条件を守る
- ✅ 感情的にならない
- ✅ データを信じる
- ✅ 長期視点を持つ

このシステムを使って、あなたなりの「勝てる条件」を見つけてください。

---

**最終更新**: 2026年1月13日  
**バージョン**: Phase 10  
**関連ドキュメント**: [ユーザーガイド](USER_GUIDE.md) | [システム概要](SYSTEM_OVERVIEW.md)
